{% load static %}
{% load i18n %}

<div class="container-fluid p-3">
    <!-- Foto Wajah -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="fw-bold text-primary mb-0">
                    <i class="fas fa-camera me-2"></i>{% trans "Face Photos" %}
                    <span class="badge bg-primary rounded-pill ms-2">{{ foto_wajah|length }}</span>
                </h5>
                {% if foto_wajah %}
                <button type="button" 
                        class="btn btn-primary btn-sm"
                        onclick="downloadAllPhotos('{{ mahasiswa.id }}', '{{ mahasiswa.user.nama_lengkap }}', '{{ mahasiswa.user.nrp }}')">
                    <i class="fas fa-download me-2"></i>{% trans "Download ZIP" %}
                </button>
                {% endif %}
            </div>
            
            {% if foto_wajah %}
            <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 g-3">
                {% for foto in foto_wajah %}
                <div class="col">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body p-2 text-center">
                            {% if foto.file_path %}
                            <img src="{{ foto.file_path.url }}" 
                                 alt="{% trans 'Photo' %} {{ forloop.counter }}" 
                                 class="img-fluid rounded mb-2"
                                 style="height: 100px; object-fit: cover; width: 100%;"
                                 onerror="this.onerror=null;">
                            {% else %}
                            <div class="bg-light rounded d-flex align-items-center justify-content-center mb-2" 
                                 style="height: 100px;">
                                <i class="fas fa-user text-muted fa-2x"></i>
                            </div>
                            {% endif %}
                            <small class="text-muted d-block">{% trans "Photo" %} {{ forloop.counter }}</small>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle me-2"></i>
                {% trans "No face photos uploaded" %}
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Informasi Mahasiswa -->
    <div class="row mb-5">
        <div class="col-12">
            <h5 class="fw-bold text-primary mb-3">
                <i class="fas fa-info-circle me-2"></i>{% trans "Student Information" %}
            </h5>
        </div>
        
        <div class="col-md-6 mb-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h6 class="card-title text-primary fw-semibold mb-3">{% trans "Personal Data" %}</h6>
                    <div class="info-item mb-3">
                        <div class="text-muted small mb-1">{% trans "Full Name" %}</div>
                        <div class="fw-bold">{{ mahasiswa.user.nama_lengkap }}</div>
                    </div>
                    <div class="info-item mb-3">
                        <div class="text-muted small mb-1">{% trans "Student ID" %}</div>
                        <div class="fw-bold font-monospace">{{ mahasiswa.user.nrp }}</div>
                    </div>
                    <div class="info-item mb-3">
                        <div class="text-muted small mb-1">{% trans "Email" %}</div>
                        <div class="fw-bold">{{ mahasiswa.user.email }}</div>
                    </div>
                    <div class="info-item">
                        <div class="text-muted small mb-1">{% trans "Registration Date" %}</div>
                        <div class="fw-bold">{{ mahasiswa.user.date_joined|date:"d M Y H:i" }}</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6 mb-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h6 class="card-title text-primary fw-semibold mb-3">{% trans "Academic Data" %}</h6>
                    <div class="row">
                        <div class="col-6 mb-3">
                            <div class="text-muted small mb-1">{% trans "Education Level" %}</div>
                            <div>
                                {% if mahasiswa.jenjang_pendidikan %}
                                <span class="badge bg-secondary">{{ mahasiswa.jenjang_pendidikan.nama_jenjang }}</span>
                                {% else %}
                                <span class="text-muted">-</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="text-muted small mb-1">{% trans "Semester" %}</div>
                            <div>
                                {% if mahasiswa.semester %}
                                <span class="badge bg-info">{{ mahasiswa.semester.nama_semester }}</span>
                                {% else %}
                                <span class="text-muted">-</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="text-muted small mb-1">{% trans "Year of Entry" %}</div>
                            <div class="fw-bold">{{ mahasiswa.angkatan|default:"-" }}</div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="text-muted small mb-1">{% trans "Class" %}</div>
                            <div class="fw-bold">{{ mahasiswa.kelas|default:"-" }}</div>
                        </div>
                        <div class="col-12">
                            <div class="text-muted small mb-1">{% trans "Major/Study Program" %}</div>
                            <div>
                                {% if mahasiswa.jurusan %}
                                <span class="badge bg-primary">{{ mahasiswa.jurusan }}</span>
                                {% else %}
                                <span class="text-muted">-</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dosen Pembimbing (Minimalis) -->
    {% if dosen_pembimbing_list %}
    <div class="row mb-5">
        <div class="col-12">
            <h5 class="fw-bold text-primary mb-3">
                <i class="fas fa-user-tie me-2"></i>{% trans "Supervising Lecturers" %}
            </h5>
        </div>
        
        {% for pembimbing in dosen_pembimbing_list %}
        <div class="col-md-4 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body p-3">
                    <div class="d-flex align-items-start">
                        <div class="flex-shrink-0">
                            <div class="avatar-sm rounded-circle bg-primary bg-opacity-10 d-flex align-items-center justify-content-center">
                                <i class="fas fa-user-graduate text-primary"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="mb-1 fw-bold text-primary">{{ pembimbing.get_tipe_pembimbing_display }}</h6>
                            <p class="mb-0 fw-semibold">{{ pembimbing.dosen.nama_dosen }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Mata Kuliah Lab (Minimalis) -->
    {% if kegiatan_pa_list %}
    <div class="row">
        <div class="col-12">
            <h5 class="fw-bold text-primary mb-3">
                <i class="fas fa-flask me-2"></i>{% trans "Laboratory Courses" %}
            </h5>
        </div>
        
        {% for kegiatan in kegiatan_pa_list %}
        <div class="col-md-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body p-3">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h6 class="mb-0 fw-bold">{{ kegiatan.nama_kegiatan }}</h6>
                        <span class="badge bg-primary">{{ kegiatan.jumlah_sks }} {% trans "Credits" %}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <div>
                            <small class="text-muted d-block">{% trans "Target Hours" %}</small>
                            <span class="fw-bold">{{ kegiatan.target_jam }} {% trans "hours" %}</span>
                        </div>
                        <div>
                            <small class="text-muted d-block">{% trans "Hours/Week" %}</small>
                            <span class="fw-bold">{{ kegiatan.total_jam_minggu }} {% trans "hours" %}</span>
                        </div>
                    </div>
                    <div class="border-top pt-2 mt-2">
                        <small class="text-muted">{% trans "Academic Year" %}:</small>
                        <div class="fw-bold">{{ kegiatan.tahun_ajaran.nama_tahun_ajaran }}</div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>

<script>
function downloadAllPhotos(mahasiswaId, nama, nrp) {
    const button = event.target;
    const originalText = button.innerHTML;
    
    // Show loading
    button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>{% trans "Processing..." %}';
    button.disabled = true;
    
    // Create download link
    const link = document.createElement('a');
    link.href = `?download=${mahasiswaId}`;
    link.style.display = 'none';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    // Reset button setelah 2 detik
    setTimeout(() => {
        button.innerHTML = originalText;
        button.disabled = false;
        
        // Show success message
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-success alert-dismissible fade show position-fixed';
        alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 1060; min-width: 300px;';
        alertDiv.innerHTML = `
            <div class="d-flex align-items-center">
                <i class="fas fa-check-circle me-2"></i>
                <div>{% trans "Photo download successfully started" %}</div>
                <button type="button" class="btn-close ms-auto" data-bs-dismiss="alert"></button>
            </div>
        `;
        document.body.appendChild(alertDiv);
        
        // Auto remove after 3 seconds
        setTimeout(() => {
            if (alertDiv.parentNode) alertDiv.remove();
        }, 3000);
    }, 2000);
}
</script>

<style>
.avatar-lg {
    width: 70px;
    height: 70px;
}

.avatar-sm {
    width: 40px;
    height: 40px;
}

.info-item {
    padding: 8px 0;
    border-bottom: 1px solid rgba(0,0,0,0.05);
}

.info-item:last-child {
    border-bottom: none;
}

.card {
    border-radius: 10px;
}

.modal-content {
    border-radius: 12px;
}

@media (max-width: 768px) {
    .avatar-lg {
        width: 50px;
        height: 50px;
    }
    
    .col-md-4, .col-md-6 {
        margin-bottom: 1rem;
    }
}
</style>