{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Credit Progress" %}{% endblock %}
{% block page_title %}{% trans "Credit Progress" %}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Main card -->
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-graph-up me-2"></i>
                        {% trans "Credit Progress" %}
                    </h5>
                    <div class="d-flex align-items-center gap-2">
                        <span class="badge bg-primary">
                            <i class="bi bi-book me-1"></i>
                            {% trans "Total Credits" %}: {{ total_sks }} {% trans "Credits" %}
                        </span>
                        <span class="badge bg-secondary">
                            <i class="bi bi-list-check me-1"></i>
                            {% trans "Activities" %}: {{ jumlah_kegiatan }}
                        </span>
                    </div>
                </div>
                <div class="card-body">

                    <!-- Student Info -->
                    <div class="alert alert-info mb-4">
                        <div class="row">
                            <div class="col-md-6">
                                <strong><i class="bi bi-person-circle me-2"></i>{% trans "Student" %}:</strong>
                                {{ mahasiswa.user.nama_lengkap }} ({{ mahasiswa.nim }})
                            </div>
                            <div class="col-md-6">
                                <strong><i class="bi bi-calendar3 me-2"></i>{% trans "Semester" %}:</strong>
                                {{ mahasiswa.semester.nama_semester|default:"-" }}
                            </div>
                        </div>
                    </div>

                    <!-- Progress Bar and Statistics -->
                    <div class="row mb-4">
                        <!-- Main Progress Bar -->
                        <div class="col-12 mb-4">
                            <div class="card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h6 class="mb-0">{% trans "Overall SKS Progress" %} 
                                            <small class="text-muted">({{ jumlah_kegiatan }} {% trans "activities" %})</small>
                                        </h6>
                                        <span class="badge bg-success">{{ progress_percentage|floatformat:2 }}%</span>
                                    </div>
                                    <div class="progress mb-3" style="height: 25px;">
                                        <div class="progress-bar bg-success progress-bar-striped progress-bar-animated"
                                            role="progressbar" data-progress="{{ progress_percentage }}"
                                            aria-valuenow="{{ progress_percentage }}" aria-valuemin="0"
                                            aria-valuemax="100">
                                            {{ progress_percentage|floatformat:2 }}%
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <small class="text-muted">{% trans "Completed Hours" %}: {{ jam_terselesaikan }}
                                            {% trans "hours" %}</small>
                                        <small class="text-muted">{% trans "Target Hours" %}: {{ jam_target_total }} {%
                                            trans "hours" %}</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Statistics Cards -->
                        <div class="col-md-3 mb-3">
                            <div class="card border-primary bg-primary bg-opacity-10">
                                <div class="card-body text-center">
                                    <h2 class="mb-1 text-primary">{{ total_sks }}</h2>
                                    <p class="mb-0 text-muted" style="font-size: 14px;">
                                        <i class="bi bi-book me-1"></i> {% trans "Total Credits" %}
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3 mb-3">
                            <div class="card border-success bg-success bg-opacity-10">
                                <div class="card-body text-center">
                                    <h2 class="mb-1 text-success">{{ jam_terselesaikan }}</h2>
                                    <p class="mb-0 text-muted" style="font-size: 14px;">
                                        <i class="bi bi-check-circle me-1"></i> {% trans "Completed Hours" %}
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3 mb-3">
                            <div class="card border-warning bg-warning bg-opacity-10">
                                <div class="card-body text-center">
                                    <h2 class="mb-1 text-warning">{{ jam_sisa }}</h2>
                                    <p class="mb-0 text-muted" style="font-size: 14px;">
                                        <i class="bi bi-clock me-1"></i> {% trans "Remaining Hours" %}
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3 mb-3">
                            <div class="card border-info bg-info bg-opacity-10">
                                <div class="card-body text-center">
                                    <h2 class="mb-1 text-info">{{ jumlah_kegiatan }}</h2>
                                    <p class="mb-0 text-muted" style="font-size: 14px;">
                                        <i class="bi bi-list-check me-1"></i> {% trans "Activities" %}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Debug Info (Optional - bisa dihapus setelah testing) -->
                    {% if debug_mode %}
                    <div class="alert alert-warning">
                        <h6>Debug Info:</h6>
                        <p>Total SKS: {{ total_sks }}</p>
                        <p>Target Hours: {{ jam_target_total }}</p>
                        <p>Completed Hours: {{ jam_terselesaikan }}</p>
                        <p>Progress Percentage: {{ progress_percentage|floatformat:2 }}%</p>
                    </div>
                    {% endif %}

                    <!-- Completion Estimate -->
                    {% if estimasi_selesai %}
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="bi bi-calendar-check me-2"></i>
                                        {% trans "Completion Estimate" %}
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <div class="card border-light">
                                                <div class="card-body text-center">
                                                    <h4 class="mb-1 text-primary">{{ rata_per_minggu }}</h4>
                                                    <p class="mb-0 text-muted">
                                                        <i class="bi bi-speedometer2 me-1"></i> {% trans "Average per Week" %}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="card border-light">
                                                <div class="card-body text-center">
                                                    <h4 class="mb-1 text-success">{{ estimasi_selesai }}</h4>
                                                    <p class="mb-0 text-muted">
                                                        <i class="bi bi-calendar-date me-1"></i> {% trans "Estimated Completion" %}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="card border-light">
                                                <div class="card-body text-center">
                                                    <h4 class="mb-1 text-warning">{{ rekomendasi_per_hari }}</h4>
                                                    <p class="mb-0 text-muted">
                                                        <i class="bi bi-lightbulb me-1"></i> {% trans "Recommendation per day (hours)" %}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="alert alert-light mt-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <i class="bi bi-info-circle me-2"></i>
                                                <strong>{% trans "Note" %}:</strong> {% trans "Based on your current progress, you need approximately" %}
                                                <span class="text-warning">{{ sisa_waktu }} {% trans "days" %}</span>
                                                {% trans "to complete all activities." %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <!-- Jika belum ada estimasi, tampilkan info -->
                    <div class="alert alert-warning mt-4">
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>{% trans "Information" %}:</strong> 
                        {% trans "Start logging your activity hours to see completion estimates." %}
                    </div>
                    {% endif %}

                </div>
            </div>
        </div>
    </div>
</div>

<!-- Hidden data untuk JavaScript -->
<div id="js-data" data-js="{{ js_data_json }}" style="display: none;"></div>

{% endblock %}

{% block extra_css %}
<style>
    .table th {
        background-color: #f8f9fa;
        font-weight: 600;
    }

    .progress {
        border-radius: 10px;
    }

    .progress-bar {
        border-radius: 10px;
        font-weight: 600;
        font-size: 12px;
        line-height: 20px;
    }

    .card-title {
        color: #2d3748;
    }

    .badge {
        font-size: 12px;
        padding: 5px 10px;
    }

    .table-responsive {
        border-radius: 8px;
        border: 1px solid #e9ecef;
    }

    /* Style for statistics cards */
    .card.border-primary .card-body h2 {
        color: #0d6efd;
    }

    .card.border-success .card-body h2 {
        color: #198754;
    }

    .card.border-info .card-body h2 {
        color: #0dcaf0;
    }

    .card.border-warning .card-body h2 {
        color: #ffc107;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    // Progress bar animation when page loads
    document.addEventListener('DOMContentLoaded', function () {
        // Animate main progress bar
        const mainProgressBar = document.querySelector('.progress-bar.progress-bar-striped');
        if (mainProgressBar) {
            const targetProgress = parseInt(mainProgressBar.getAttribute('data-progress') || 0);
            let currentProgress = 0;
            const interval = setInterval(() => {
                if (currentProgress >= targetProgress) {
                    clearInterval(interval);
                    return;
                }
                currentProgress += 1;
                mainProgressBar.style.width = currentProgress + '%';
                mainProgressBar.setAttribute('aria-valuenow', currentProgress);
                mainProgressBar.textContent = currentProgress + '%';
            }, 20);
        }
    });
</script>
{% endblock %}