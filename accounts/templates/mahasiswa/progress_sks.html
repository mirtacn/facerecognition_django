{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Credit Progress" %}{% endblock %}
{% block page_title %}{% trans "Credit Progress" %}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Main card -->
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-graph-up me-2"></i>
                        {% trans "Credit Progress" %}
                    </h5>
                    <div class="d-flex align-items-center gap-2">
                        <span class="badge bg-primary">
                            <i class="bi bi-book me-1"></i>
                            {% trans "Credits" %}: 12 {% trans "Credits" %}
                        </span>
                    </div>
                </div>
                <div class="card-body">
                    
                    <!-- Credit Info -->
                    <div class="alert alert-primary mb-4">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-info-circle-fill me-2"></i>
                            <div>
                                <strong>{% trans "This Semester's Credit Progress" %}</strong> - {% trans "Total Credits" %}: 12 {% trans "Credits" %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Progress Bar and Statistics -->
                    <div class="row mb-4">
                        <!-- Main Progress Bar -->
                        <div class="col-12 mb-4">
                            <div class="card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h6 class="mb-0">{% trans "Overall Semester Progress" %}</h6>
                                        <span class="badge bg-success">68%</span>
                                    </div>
                                    <div class="progress mb-3" style="height: 25px;">
                                        <div class="progress-bar bg-success progress-bar-striped progress-bar-animated" 
                                             role="progressbar" 
                                             style="width: 68%"
                                             aria-valuenow="68" 
                                             aria-valuemin="0" 
                                             aria-valuemax="100">
                                            68%
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <small class="text-muted">{% trans "Completed Hours" %}: 234 {% trans "hours" %}</small>
                                        <small class="text-muted">{% trans "Target Hours" %}: 344 {% trans "hours" %}</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Statistics Card -->
                        <div class="col-md-4 mb-3">
                            <div class="card border-primary bg-primary bg-opacity-10">
                                <div class="card-body text-center">
                                    <h2 class="mb-1 text-primary">12</h2>
                                    <p class="mb-0 text-muted" style="font-size: 14px;">
                                        <i class="bi bi-tools me-1"></i> {% trans "Total Credits" %}
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <div class="card border-success bg-success bg-opacity-10">
                                <div class="card-body text-center">
                                    <h2 class="mb-1 text-success">234</h2>
                                    <p class="mb-0 text-muted" style="font-size: 14px;">
                                        <i class="bi bi-clock-history me-1"></i> {% trans "Completed Hours" %}
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <div class="card border-info bg-info bg-opacity-10">
                                <div class="card-body text-center">
                                    <h2 class="mb-1 text-info">110</h2>
                                    <p class="mb-0 text-muted" style="font-size: 14px;">
                                        <i class="bi bi-clock me-1"></i> {% trans "Remaining Hours" %}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Progress Details -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="bi bi-bar-chart me-2"></i>
                                        {% trans "Credit Progress Details" %}
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>{% trans "Description" %}</th>
                                                    <th class="text-center">{% trans "Amount" %}</th>
                                                    <th class="text-center">{% trans "Status" %}</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>
                                                        <i class="bi bi-tools me-2"></i>
                                                        <strong>{% trans "Total Credits" %}</strong>
                                                    </td>
                                                    <td class="text-center">
                                                        <span class="badge bg-primary">12 {% trans "Credits" %}</span>
                                                    </td>
                                                    <td class="text-center">
                                                        <span class="badge bg-info">{% trans "Active" %}</span>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <i class="bi bi-clock-history me-2"></i>
                                                        <strong>{% trans "Completed Hours" %}</strong>
                                                        <p class="mb-0 text-muted small">{% trans "From 344 target hours" %}</p>
                                                    </td>
                                                    <td class="text-center">
                                                        <span class="badge bg-success">234 {% trans "hours" %}</span>
                                                    </td>
                                                    <td class="text-center">
                                                        <span class="badge bg-success">68%</span>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <i class="bi bi-clock me-2"></i>
                                                        <strong>{% trans "Remaining Hours" %}</strong>
                                                        <p class="mb-0 text-muted small">{% trans "To reach target" %}</p>
                                                    </td>
                                                    <td class="text-center">
                                                        <span class="badge bg-warning text-dark">110 {% trans "hours" %}</span>
                                                    </td>
                                                    <td class="text-center">
                                                        <span class="badge bg-warning text-dark">{% trans "In Progress" %}</span>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <i class="bi bi-target me-2"></i>
                                                        <strong>{% trans "Total Target Hours" %}</strong>
                                                        <p class="mb-0 text-muted small">{% trans "This semester's target" %}</p>
                                                    </td>
                                                    <td class="text-center">
                                                        <span class="badge bg-primary">344 {% trans "hours" %}</span>
                                                    </td>
                                                    <td class="text-center">
                                                        <span class="badge bg-primary">{% trans "Target" %}</span>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Summary -->
                    <div class="alert alert-success mt-4">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <i class="bi bi-check-circle-fill me-2"></i>
                                <strong>{% trans "Progress Status" %}:</strong> 
                                <span class="text-success">{% trans "Excellent" %}</span>
                            </div>
                            <div>
                                <button class="btn btn-outline-primary btn-sm" onclick="exportProgressReport()">
                                    <i class="bi bi-file-earmark-pdf me-1"></i> {% trans "Export Report" %}
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Completion Estimate -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="bi bi-calendar-check me-2"></i>
                                        {% trans "Completion Estimate" %}
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <p class="mb-1">
                                                <strong>{% trans "Average per Week" %}:</strong> 
                                                <span class="text-success">15.6 {% trans "hours" %}</span>
                                            </p>
                                            <p class="mb-0">
                                                <strong>{% trans "Estimated Completion" %}:</strong> 
                                                <span class="text-primary">25 December 2024</span>
                                            </p>
                                        </div>
                                        <div class="text-end">
                                            <p class="mb-1">
                                                <strong>{% trans "Time Remaining" %}:</strong> 
                                                <span class="text-warning">45 {% trans "days" %}</span>
                                            </p>
                                            <p class="mb-0">
                                                <strong>{% trans "Recommendation/hour" %}:</strong> 
                                                <span class="text-info">2.44 {% trans "hours/day" %}</span>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .table th {
        background-color: #f8f9fa;
        font-weight: 600;
    }
    
    .progress {
        border-radius: 10px;
    }
    
    .progress-bar {
        border-radius: 10px;
        font-weight: 600;
        font-size: 14px;
        line-height: 25px;
    }
    
    .card-title {
        color: #2d3748;
    }
    
    .badge {
        font-size: 12px;
        padding: 5px 10px;
    }
    
    .table-responsive {
        border-radius: 8px;
        border: 1px solid #e9ecef;
    }
    
    /* Style for statistics cards */
    .card.border-primary .card-body h2 {
        color: #0d6efd;
    }
    
    .card.border-success .card-body h2 {
        color: #198754;
    }
    
    .card.border-info .card-body h2 {
        color: #0dcaf0;
    }
    
    .card.border-warning .card-body h2 {
        color: #ffc107;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    // Static data (hardcoded) to avoid errors
    const progressPercentage = 68; // (234/344)*100 = 68%
    const jamTerselesaikan = 234;
    const jamSisa = 110; // 344 - 234
    
    console.log('Progress:', progressPercentage + '%');
    console.log('{% trans "Completed Hours" %}:', jamTerselesaikan + ' {% trans "hours" %}');
    console.log('{% trans "Remaining Hours" %}:', jamSisa + ' {% trans "hours" %}');
    
    // Function to export report
    function exportProgressReport() {
        showNotification("{% trans 'Preparing credit progress report...' %}", 'info');
        
        // Simulate download delay
        setTimeout(() => {
            // Create report content
            const reportContent = `
                {% trans "CREDIT PROGRESS REPORT" %}
                ====================
                {% trans "Date" %}: ${new Date().toLocaleDateString('id-ID')}
                
                {% trans "Total Credits" %}: 12 {% trans "Credits" %}
                {% trans "Total Target Hours" %}: 344 {% trans "hours" %}
                {% trans "Completed Hours" %}: 234 {% trans "hours" %} (68%)
                {% trans "Remaining Hours" %}: 110 {% trans "hours" %}
                
                {% trans "Status" %}: {% trans "Excellent" %}
                
                {% trans "Estimated Completion" %}: 25 December 2024
                {% trans "Recommendation" %}: 2.44 {% trans "hours per day" %}
            `;
            
            // Simulate file download
            const link = document.createElement('a');
            link.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(reportContent);
            link.download = `credit_progress_${new Date().toISOString().slice(0,10)}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification("{% trans 'Progress report successfully downloaded' %}", 'success');
        }, 1500);
    }
    
    // Function to show notification
    function showNotification(message, type) {
        // Remove old notifications
        const oldAlerts = document.querySelectorAll('.alert.position-fixed');
        oldAlerts.forEach(alert => alert.remove());
        
        // Create new notification
        const alert = document.createElement('div');
        alert.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
        alert.style.cssText = `
            z-index: 1060;
            top: 20px;
            right: 20px;
            min-width: 300px;
            max-width: 400px;
        `;
        
        const icon = type === 'success' ? 'bi-check-circle-fill' : 
                     type === 'info' ? 'bi-info-circle-fill' : 
                     type === 'warning' ? 'bi-exclamation-triangle-fill' : 
                     'bi-exclamation-circle-fill';
        
        alert.innerHTML = `
            <div class="d-flex align-items-center">
                <i class="bi ${icon} me-2 fs-5"></i>
                <div class="flex-grow-1">${message}</div>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        `;
        
        document.body.appendChild(alert);
        
        // Auto hide after 3 seconds
        setTimeout(() => {
            if (alert.parentNode) {
                alert.remove();
            }
        }, 3000);
    }
    
    // Progress bar animation when page loads
    document.addEventListener('DOMContentLoaded', function() {
        // Animate progress bar
        const progressBar = document.querySelector('.progress-bar');
        let currentProgress = 0;
        const interval = setInterval(() => {
            if (currentProgress >= progressPercentage) {
                clearInterval(interval);
                return;
            }
            currentProgress += 1;
            progressBar.style.width = currentProgress + '%';
            progressBar.setAttribute('aria-valuenow', currentProgress);
            progressBar.textContent = currentProgress + '%';
        }, 20);
        
        console.log('{% trans "Progress bar animation started..." %}');
    });
</script>
{% endblock %}